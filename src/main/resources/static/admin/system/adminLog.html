<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<title>任务订单后台管理列表</title>
<link rel="stylesheet" href="../lib/layui/css/layui.css" media="all">
<link rel="stylesheet" href="../css/font.css">
<script src="../lib/layui/layui.js"></script>
<script src="../lib/module/common.js"></script>

</head>

<body>
	<table class="layui-table layui-container"
		lay-data="{url:'/api/getAdminLogs', page:{limit:20}, id:'item',toolbar:'#toolbarDemo'}"
		lay-filter="test" id="TablePage">
		<thead>
			<tr>
				<th lay-data="{type:'checkbox'}"></th>
				<th lay-data="{field:'logId',sort: true,align:'center'}">日志编号</th>
				<th lay-data="{field:'adminId',align:'center'}">管理员id</th>
				<th lay-data="{field:'logInfo',align:'center'}">日志描述</th>
				<th lay-data="{field:'logIp',align:'center'}">ip地址</th>
				<th lay-data="{field:'logUrl',align:'center'}">日志路径</th>
				<th lay-data="{field:'logTime',align:'center'}">日志时间</th>
				<th
					lay-data="{fixed: 'right', width:100, align:'center', toolbar: '#barDemo',align:'center'}">操作</th>
			</tr>
		</thead>
	</table>


	<script>
    //主页面菜单数据表的事件监听
    layui.use('table', function () {

      var table = layui.table;
      var $ = layui.jquery;
      var form=layui.form;
      //头工具栏事件
      table.on('toolbar', function (obj) {
        var checkStatus = table.checkStatus(obj.config.id);
        switch (obj.event) {
          case 'add':
            var data = checkStatus.data;

            layui.use('layer', function () {
              layer = layui.layer; //独立版的layer无需执行这一句
              layer.open({
                type: 1 //此处以iframe举例
                  ,
                title: '添加任务',
                area: ['500px'],
                shade: 0,
                maxmin: true,
                content: $('#formAdd'),
                zIndex:'1000' //重点      
              });
            });
            break;
          case 'delete':
            var data = checkStatus.data;
            if (data.length > 0) {
              layer.confirm('确定删除选中行么?', function (index) {
                var idList = []
                data.forEach(element => {
                  idList = idList.concat(""+element.logId);
                });
                var idListStr = JSON.stringify(idList);
                layer.close(index);
                var loading=layer.load();
               
                //向服务端发送删除指令
                $.ajax({
                    type: 'post',
                    url: '/api/deleteAdminlogs',
                    data: {
                      ids: idListStr
                    },
                    success: function (obj) {
                  	  console.log(obj);
                      if (obj.code != 0) {
                        layer.msg(obj.msg)
                      } else {
                        layer.msg("删除菜单"+obj.msg)
                      }
                    },
                    error: function (obj) {
                      layer.msg("请求异常");
                    },
                    complete: function () {
                    	layer.close(loading)
                        tableRefresh('item')
                        
                    }
                  });
                  return false;
              });
            } else {
              layer.msg("最少选中一行!");
            }
            break;
          case 'Refresh':
            tableRefresh('item')
            
            break;
        };
      });

      //监听数据主表工具条
      table.on('tool', function (obj) { //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
        var data = obj.data; //获得当前行数据
        var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
        var tr = obj.tr; //获得当前行 tr 的DOM对象

        if (layEvent === 'detail') { //查看
          if(data.level!=="三级菜单"){
            var id = data.modId
            var nav=data.title
          table.reload('SecondWindow',{
            url:'/api/getSystemModuleByPid',
            where:{
            	pid:id
            },
          })
          layui.use('layer', function () {
              layer = layui.layer; //独立版的layer无需执行这一句
              layer.open({
                type: 1,//此处以iframe举例
                title: '子菜单列表',
                area: ['1100px','500px'],
                shade: 0,
                maxmin: true,
                content: $('#SecondWindow'),
                zIndex: '1000' //重点      
              });
            });
          }else{
            layer.msg("终极菜单没有子菜单!")
          }
        } else if (layEvent === 'del') { //删除
          layer.confirm('真的删除行么', function (index) {
            var id = [];
            id = id.concat(""+data.logId);
            obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
            layer.close(index);
            idList = JSON.stringify(id)
            //向服务端发送删除指令
            var loading=layer.load();
               
            $.ajax({
              type: 'post',
              url: '/api/deleteAdminlogs',
              data: {
                ids: idList
              },
              success: function (obj) {
            	  console.log(obj);
                if (obj.code != 0) {
                  layer.msg(obj.msg)
                } else {
                  layer.msg("删除菜单"+obj.msg)
                }
              },
              error: function (obj) {
                layer.msg("请求异常");
              },
              complete: function () {
            	  layer.close(loading)
              }
            });
            return false;
          });
        } else if (layEvent === 'edit') { //编辑
          //do something

          //同步更新缓存对应的值
          obj.update({
            username: '123',
            title: 'xxx'
          });
        }
      });
    });
    //局部刷新数据表
    function tableRefresh(obj) {
      var table = layui.table;
      table.refresh(obj);
    }
    
    </script>

	</script>
	<!--工具条事件菜单主表-->
	<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
  </script>

	<!--头部工具条事件-->
	<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
    <!--  <button type="button" class="layui-btn" lay-event="add"><i class="layui-icon">&#xe608;</i> 添加</button> -->
      <button type="button" class="layui-btn layui-btn-danger" lay-event="delete"><i
          class="layui-icon">&#xe640;</i>删除选中</button>
     <button class="layui-btn layui-btn-warm" lay-event="Refresh"><i class="layui-icon">&#xe9aa;</i>刷新表格当前页</button>
    </div>
  </script>





</body>

</html>